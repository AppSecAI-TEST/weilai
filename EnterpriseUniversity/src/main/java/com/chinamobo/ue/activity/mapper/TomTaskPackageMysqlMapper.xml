<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinamobo.ue.activity.dao.TomTaskPackageMapper">
	<resultMap id="BaseResultMap"
		type="com.chinamobo.ue.activity.entity.TomTaskPackage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="PACKAGE_ID" property="packageId" jdbcType="DECIMAL" />
		<result column="PACKAGE_NUMBER" property="packageNumber"
			jdbcType="VARCHAR" />
		<result column="PACKAGE_NAME" property="packageName" jdbcType="VARCHAR" />
		
		<result column="PACKAGE_NAME_EN" property="packageNameEN" jdbcType="VARCHAR" />
		
		<result column="ADMINS" property="admins" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="CREATOR" property="creator" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
		<result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="TASK_COUNT" property="taskCount" jdbcType="DECIMAL" />
		<result column="ADMIN_NAMES" property="adminsNames" jdbcType="VARCHAR" />
		<result column="CREATOR_ID" property="creatorId" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="TomCoursesMap" type="com.chinamobo.ue.course.entity.TomCourses" >
    <id column="COURSE_ID" property="courseId" jdbcType="DECIMAL" />
    <result column="COURSE_NUMBER" property="courseNumber" jdbcType="VARCHAR" />
    <result column="COURSE_NAME" property="courseName" jdbcType="VARCHAR" />
    <result column="COURSE_ONLINE" property="courseOnline" jdbcType="VARCHAR" />
    <result column="COURSE_INTRODUCTION" property="courseIntroduction" jdbcType="VARCHAR" />
    <result column="COURSE_TYPE" property="courseType" jdbcType="VARCHAR" />
    <result column="E_CURRENCY" property="eCurrency" jdbcType="DECIMAL" />
    <result column="COURSE_GRADE_DIMENSIONS" property="courseGradeDimensions" jdbcType="VARCHAR" />
    <result column="LECTURER_GRADE_DIMENSIONS" property="lecturerGradeDimensions" jdbcType="VARCHAR" />
    <result column="LECTURERS" property="lecturers" jdbcType="VARCHAR" />
    <result column="COURSE_IMG" property="courseImg" jdbcType="VARCHAR" />
    <result column="COURSE_DOWNLOADABLE" property="courseDownloadable" jdbcType="VARCHAR" />
    <result column="IS_EXCELLENT_COURSE" property="isExcellentCourse" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="OPEN_COMMENT" property="openComment" jdbcType="VARCHAR" />
    <result column="OPEN_COURSE" property="openCourse" jdbcType="VARCHAR" />
    <result column="ADMINS" property="admins" jdbcType="VARCHAR" />
    <result column="ADMIN_NAMES" property="adminNames" jdbcType="VARCHAR" />
    <result column="VIEWERS" property="viewers" jdbcType="DECIMAL" />
    <result column="THUMB_UP_COUNT" property="thumbUpCount" jdbcType="DECIMAL" />
    <result column="COMMENT_COUNT" property="commentCount" jdbcType="DECIMAL" />
    <result column="RATETIMES" property="ratetimes" jdbcType="DECIMAL" />
    <result column="COURSE_AVERAGE" property="courseAverage" jdbcType="DECIMAL" />
    <result column="TOT_SCORE" property="totScore" jdbcType="DECIMAL" />
    <result column="LECTURER_AVERAGE" property="lecturerAverage" jdbcType="DECIMAL" />
    <result column="COURSE_TIMES" property="courseTimes" jdbcType="DECIMAL" />
    <result column="SIGN_IN_TWO_DIMENSION_CODE" property="signInTwoDimensionCode" jdbcType="VARCHAR" />
    <result column="GRADE_TWO_DIMENSION_CODE" property="gradeTwoDimensionCode" jdbcType="VARCHAR" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <resultMap id="TomExamPaperMap" type="com.chinamobo.ue.exam.entity.TomExamPaper" >
    <id column="EXAM_PAPER_ID" property="examPaperId" jdbcType="DECIMAL" />
    <result column="EXAM_PAPER_NUMBER" property="examPaperNumber" jdbcType="VARCHAR" />
    <result column="EXAM_PAPER_NAME" property="examPaperName" jdbcType="VARCHAR" />
    <result column="EXAM_PAPER_TYPE" property="examPaperType" jdbcType="VARCHAR" />
    <result column="EXAM_PAPER_PICTURE" property="examPaperPicture" jdbcType="VARCHAR" />
    <result column="EXAM_TIME" property="examTime" jdbcType="DECIMAL" />
    <result column="FULL_MARK" property="fullMark" jdbcType="DECIMAL" />
    <result column="PASS_MARK" property="passMark" jdbcType="DECIMAL" />
    <result column="TEST_QUESTION_COUNT" property="testQuestionCount" jdbcType="DECIMAL" />
    <result column="PASS_EB" property="passEb" jdbcType="DECIMAL" />
    <result column="NOT_PASS_EB" property="notPassEb" jdbcType="DECIMAL" />
    <result column="SHOW_SCORE" property="showScore" jdbcType="VARCHAR" />
    <result column="SHOW_QUALIFIED_STANDARD" property="showQualifiedStandard" jdbcType="VARCHAR" />
    <result column="IMMEDIATELY_SHOW" property="immediatelyShow" jdbcType="VARCHAR" />
    <result column="ADMINS" property="admins" jdbcType="VARCHAR" />
    <result column="ADMIN_NAMES" property="adminNames" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATOR_ID" property="creatorId" jdbcType="VARCHAR" />
    <result column="LAST_OPERATOR" property="lastOperator" jdbcType="VARCHAR" />
    <result column="LAST_OPERATOR_Id" property="lastOperatorId" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		PACKAGE_ID, PACKAGE_NUMBER, PACKAGE_NAME,PACKAGE_NAME_EN, ADMINS, STATUS, CREATOR,
		CREATE_TIME, OPERATOR,
		UPDATE_TIME,TASK_COUNT,ADMIN_NAMES,CREATOR_ID
	</sql>
	<!-- <sql id="TASK_PACKAGE_SEQ">TASK_PACKAGE_SEQ.nextval</sql> -->
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from TOM_TASK_PACKAGE
		where PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from TOM_TASK_PACKAGE
		where PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
	</delete>
	<insert id="insert" useGeneratedKeys="true" keyProperty="packageId" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into TOM_TASK_PACKAGE (<!-- PACKAGE_ID, --> PACKAGE_NUMBER,
		PACKAGE_NAME,PACKAGE_NAME_EN,
		ADMINS, STATUS, CREATOR,
		CREATE_TIME, OPERATOR, UPDATE_TIME,TASK_COUNT,CREATOR_ID
		)
		values (<!-- TASK_PACKAGE_SEQ.nextval, --> #{packageNumber,jdbcType=VARCHAR},
		#{packageName,jdbcType=VARCHAR},#{packageNameEN,jdbcType=VARCHAR},
		#{admins,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, #{creator,jdbcType=VARCHAR},
		#{createTime,jdbcType=TIMESTAMP}, #{operator,jdbcType=VARCHAR},
		#{updateTime,jdbcType=TIMESTAMP},#{taskCount,jdbcType=DECIMAL},#{creatorId,jdbcType=DECIMAL}
		)
	</insert>

	<!-- Wanglg add TaskPackage 2016年3月10日 -->
	<insert id="insertSelective" useGeneratedKeys="true" keyProperty="packageId" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<!-- <selectKey keyProperty="packageId" resultType="Integer" order="BEFORE">
			select
			<include refid="TASK_PACKAGE_SEQ" />
			from dual
		</selectKey> -->
		insert into TOM_TASK_PACKAGE
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<!-- <if test="packageId != null">
				PACKAGE_ID,
			</if> -->
			<if test="packageNumber != null">
				PACKAGE_NUMBER,
			</if>
			<if test="packageName != null">
				PACKAGE_NAME,
			</if>
			<if test="packageNameEN != null">
				PACKAGE_NAME_EN,
			</if>
			<if test="admins != null">
				ADMINS,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="creator != null">
				CREATOR,
			</if>
			<if test="createTime != null">
				CREATE_TIME,
			</if>
			<if test="operator != null">
				OPERATOR,
			</if>
			<if test="updateTime != null">
				UPDATE_TIME,
			</if>
			<if test="taskCount != null">
				TASK_COUNT,
			</if>
			<if test="creatorId != null">
				CREATOR_ID,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<!-- <if test="packageId != null" > 
				#{packageId,jdbcType=DECIMAL}, 
			</if> -->
			<if test="packageNumber != null">
				#{packageNumber,jdbcType=VARCHAR},
			</if>
			<if test="packageName != null">
				#{packageName,jdbcType=VARCHAR},
			</if>
			<if test="packageNameEN != null">
				#{packageNameEN,jdbcType=VARCHAR},
			</if>
			<if test="admins != null">
				#{admins,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=VARCHAR},
			</if>
			<if test="creator != null">
				#{creator,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="operator != null">
				#{operator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="taskCount != null">
				#{taskCount,jdbcType=DECIMAL},
			</if>
			<if test="creatorId != null">
				#{creatorId,jdbcType=DECIMAL}
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update TOM_TASK_PACKAGE
		<set>
			<if test="packageNumber != null">
				PACKAGE_NUMBER = #{packageNumber,jdbcType=VARCHAR},
			</if>
			<if test="packageName != null">
				PACKAGE_NAME = #{packageName,jdbcType=VARCHAR},
			</if>
			<if test="packageNameEN != null">
				PACKAGE_NAME_EN = #{packageNameEN,jdbcType=VARCHAR},
			</if>
			<if test="admins != null">
				ADMINS = #{admins,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=VARCHAR},
			</if>
			<if test="creator != null">
				CREATOR = #{creator,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="operator != null">
				OPERATOR = #{operator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="taskCount != null">
				TASK_COUNT = #{taskCount,jdbcType=DECIMAL},
			</if>
			<if test="creatorId != null">
				CREATOR_ID=#{creatorId,jdbcType=DECIMAL}
			</if>
		</set>
		where PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update TOM_TASK_PACKAGE
		set PACKAGE_NUMBER = #{packageNumber,jdbcType=VARCHAR},
		PACKAGE_NAME = #{packageName,jdbcType=VARCHAR},
		PACKAGE_NAME_EN = #{packageNameEN,jdbcType=VARCHAR},
		ADMINS = #{admins,jdbcType=VARCHAR},
		STATUS = #{status,jdbcType=VARCHAR},
		CREATOR = #{creator,jdbcType=VARCHAR},
		CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
		OPERATOR = #{operator,jdbcType=VARCHAR},
		UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
		TASK_COUNT = #{taskCount,jdbcType=DECIMAL},
		CREATOR_ID=#{creatorId,jdbcType=DECIMAL}
		where PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
	</update>

	<!-- Wanglg add TaskPackage 2016年3月10日 <resultMap extends="BaseResultMap" 
		id="ResultMapWithByParam" type="com.chinamobo.ue.activity.entity.TomTaskPackage"> 
		<result column="CDESC" jdbcType="CLOB" property="cdesc" /> <collection property="userRoles" 
		column="CID" javaType="list" select="selectUserRole"></collection> </resultMap> -->

	<sql id="Base_Column_List1">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		PACKAGE_ID, PACKAGE_NUMBER, PACKAGE_NAME,PACKAGE_NAME_EN, ADMINS, STATUS, CREATOR,
		CREATE_TIME, OPERATOR,
		UPDATE_TIME,TASK_COUNT,COUNT(ACTIVITY_ID) AS "activityCount"
	</sql>
	<select id="selectListByParam" resultMap="BaseResultMap" parameterType="map">
		
					SELECT pa.*
					FROM TOM_TASK_PACKAGE pa WHERE pa.STATUS = 'Y'
				<if test="packageName!=null">
					and INSTR(PACKAGE_NAME,#{packageName,jdbcType=VARCHAR})>0
				</if>
				order by pa.UPDATE_TIME desc
			limit<![CDATA[
           #{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>

	<select id="countByList" parameterType="map"
		resultType="java.lang.Integer">
		select count(*) from TOM_TASK_PACKAGE where STATUS='Y'
		<if test="packageName != null and '' != packageName " >
        and INSTR(PACKAGE_NAME,#{packageName,jdbcType=VARCHAR})>0 
      </if>
	</select>
	
	<select id="selectAllList" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from TOM_TASK_PACKAGE where STATUS='Y'
		<if test="packageName != null and '' != packageName ">
			and INSTR(PACKAGE_NAME,#{packageName,jdbcType=VARCHAR})>0 
		</if>
	</select>
	
	 <!-- 选择活动 -->
   	<select id="selectAllTask" parameterType="com.chinamobo.ue.activity.entity.TomTaskPackage" resultMap="BaseResultMap">
		   	SELECT
		tp.package_id,
		tp.package_name,
		tp.package_name_EN,
		tp.PACKAGE_NUMBER,
		COUNT(ap.activity_id) AS "activityCount",
		tp.CREATOR,
		tp.CREATE_TIME,
		tp.OPERATOR,
		tp.UPDATE_TIME
		FROM tom_task_package tp
		LEFT JOIN tom_activity_property ap
		ON ap.package_id = tp.package_id
		 where STATUS='Y'
		GROUP BY ap.package_id,
		tp.package_id,tp.package_name,tp.PACKAGE_NUMBER,tp.CREATOR,tp.CREATE_TIME,tp.OPERATOR,tp.UPDATE_TIME
		where 1=1
		<if test="packageName != null and '' != packageName ">
			and INSTR(PACKAGE_NAME,#{packageName,jdbcType=VARCHAR})>0 
		</if>
 	</select>

   <!-- <select id="selectDetails" resultType="com.chinamobo.ue.activity.dto.TomTaskPackageDto" parameterType="map">
		SELECT 
		t.ADMINS_NAMES AS adminsName,
		t.ADMINS AS adminId,
		t.PACKAGE_ID AS packageId,
		t.PACKAGE_NAME AS packageName,
		te.EXAM_ID AS examIds,
		tc.COURSE_ID AS courseIds,
		co.COURSE_NAME AS courseNames,
		em.EXAM_NAME AS examNames
		FROM TOM_TASK_PACKAGE t
		LEFT JOIN tom_task_exam_relation te
		ON te.package_id = t.package_id
		LEFT JOIN tom_task_courses_relation tc
		ON tc.package_id = t.package_id
		LEFT JOIN tom_courses co
		ON co.COURSE_ID = tc.COURSE_ID
		LEFT JOIN TOM_EXAM em
		ON em.EXAM_ID = te.EXAM_ID
		where 1=1
		<if test="packageId != null and '' != packageId ">
			and PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
		</if>
   </select> -->

    <select id="selectDetailsExamPaper" resultMap="TomExamPaperMap" parameterType="map">
  		SELECT ex.*
  		FROM TOM_EXAM_PAPER ex
		LEFT JOIN TOM_TASK_EXAM_PAPER_RELATION ta
		ON ex.EXAM_PAPER_ID=ta.EXAM_PAPER_ID
		where 1=1
		<if test="packageId != null and '' != packageId ">
			and ta.PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
		</if>
   </select>
  
   <select id="selectDetailsCourse" resultMap="TomCoursesMap" parameterType="map">
  	    SELECT co.*
  		FROM TOM_COURSES co
		LEFT JOIN TOM_TASK_COURSES_RELATION ta
		ON co.COURSE_ID=ta.COURSE_ID
		where 1=1
		<if test="packageId != null and '' != packageId ">
			and ta.PACKAGE_ID = #{packageId,jdbcType=DECIMAL}
		</if>
   </select>
   <!-- 根据活动id查询任务包 -->
<select id="selectByAdminId" parameterType="int" resultMap="BaseResultMap">
		   	SELECT
		tp.package_id 		
		FROM tom_activity ta
		LEFT JOIN tom_activity_property ap
		ON ap.activity_id = ta.activity_id
		left join tom_task_package tp on ap.package_id = tp.package_id
		where  ta.activity_id  =#{_parameter}
 	</select>
</mapper>