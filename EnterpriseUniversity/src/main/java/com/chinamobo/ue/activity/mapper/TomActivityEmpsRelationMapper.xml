<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinamobo.ue.activity.dao.TomActivityEmpsRelationMapper">
	<resultMap id="BaseResultMap"
		type="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="ACTIVITY_ID" property="activityId" jdbcType="DECIMAL" />
		<id column="CODE" property="code" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="APPLY_STATUS" property="applyStatus" jdbcType="VARCHAR" />
		<result column="APPLY_TYPE" property="applyType" jdbcType="VARCHAR" />
		<result column="IS_REQUIRED" property="isRequired" jdbcType="VARCHAR" />
		<result column="CREATOR" property="creator" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
		<result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
	</resultMap>
	<resultMap type="com.chinamobo.ue.activity.dto.TomActivityEmpDto" id="ResultActivityEmpMap">
	  <result column="NAME" property="name" jdbcType="VARCHAR"/>
	  <result column="CODE" property="code" jdbcType="VARCHAR"/>
	  <result column="SECRET_EMAIL" property="secretEmail" jdbcType="VARCHAR"/>
	  <result column="OFFICEPHONE" property="officephone" jdbcType="VARCHAR"/>
	  <result column="DEPTNAME" property="deptname" jdbcType="VARCHAR"/>
	  <result column="POSTNAME" property="postname" jdbcType="VARCHAR"/>
	  <result column="JOBNAME" property="jobname" jdbcType="VARCHAR"/>
	</resultMap>
	<resultMap type="com.chinamobo.ue.activity.dto.TomActivityProcessDto" id="ActivityProcessMap">
	   <id column="ACTIVITY_ID" property="activityId" jdbcType="DECIMAL" />
		<id column="CODE" property="code" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="APPLY_STATUS" property="applyStatus" jdbcType="VARCHAR" />
		<result column="APPLY_TYPE" property="applyType" jdbcType="VARCHAR" />
		<result column="IS_REQUIRED" property="isRequired" jdbcType="VARCHAR" />
		<result column="CREATOR" property="creator" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
		<result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="ACTIVITY_PROCESS" property="activityProcess" jdbcType="VARCHAR" />
		<result column="FINISHED_COURSE_TASK" property="finishedCourseTask" jdbcType="INTEGER" />
		<result column="FINISHED_EXAM_TASK" property="finishedExamTask" jdbcType="INTEGER" />
		<result column="TOTAL_TASK" property="totalTask" jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		ACTIVITY_ID, CODE, STATUS, APPLY_STATUS, APPLY_TYPE, IS_REQUIRED,
		CREATOR, CREATE_TIME,
		OPERATOR, UPDATE_TIME
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelationKey">
		select
		<include refid="Base_Column_List" />
		from TOM_ACTIVITY_EMPS_RELATION
		where ACTIVITY_ID =
		#{activityId,jdbcType=DECIMAL}
		and CODE = #{code,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelationKey">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from TOM_ACTIVITY_EMPS_RELATION
		where ACTIVITY_ID =
		#{activityId,jdbcType=DECIMAL}
		and CODE = #{code,jdbcType=VARCHAR}
	</delete>
	<insert id="insert"  useGeneratedKeys="true" keyProperty="activityId"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into TOM_ACTIVITY_EMPS_RELATION (ACTIVITY_ID, CODE, STATUS,
		APPLY_STATUS, APPLY_TYPE, IS_REQUIRED,
		CREATOR, CREATE_TIME, OPERATOR,
		UPDATE_TIME)
		values (#{activity,jdbcType=DECIMAL},
		#{code,jdbcType=VARCHAR},
		#{status,jdbcType=VARCHAR},
		#{applyStatus,jdbcType=VARCHAR}, #{applyType,jdbcType=VARCHAR},
		#{isRequired,jdbcType=VARCHAR},
		#{creator,jdbcType=VARCHAR},
		#{createTime,jdbcType=TIMESTAMP},
		#{operator,jdbcType=VARCHAR},
		#{updateTime,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective"  useGeneratedKeys="true" keyProperty="activityId"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into TOM_ACTIVITY_EMPS_RELATION
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="activityId != null">
				ACTIVITY_ID,
			</if>
			<if test="code != null">
				CODE,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="applyStatus != null">
				APPLY_STATUS,
			</if>
			<if test="applyType != null">
				APPLY_TYPE,
			</if>
			<if test="isRequired != null">
				IS_REQUIRED,
			</if>
			<if test="creator != null">
				CREATOR,
			</if>
			<if test="createTime != null">
				CREATE_TIME,
			</if>
			<if test="operator != null">
				OPERATOR,
			</if>
			<if test="updateTime != null">
				UPDATE_TIME,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="activityId != null">
				#{activityId,jdbcType=DECIMAL},
			</if>
			<if test="code != null">
				#{code,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=VARCHAR},
			</if>
			<if test="applyStatus != null">
				#{applyStatus,jdbcType=VARCHAR},
			</if>
			<if test="applyType != null">
				#{applyType,jdbcType=VARCHAR},
			</if>
			<if test="isRequired != null">
				#{isRequired,jdbcType=VARCHAR},
			</if>
			<if test="creator != null">
				#{creator,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="operator != null">
				#{operator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update TOM_ACTIVITY_EMPS_RELATION
		<set>
			<if test="status != null">
				STATUS = #{status,jdbcType=VARCHAR},
			</if>
			<if test="applyStatus != null">
				APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR},
			</if>
			<if test="applyType != null">
				APPLY_TYPE = #{applyType,jdbcType=VARCHAR},
			</if>
			<if test="isRequired != null">
				IS_REQUIRED = #{isRequired,jdbcType=VARCHAR},
			</if>
			<if test="creator != null">
				CREATOR = #{creator,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="operator != null">
				OPERATOR = #{operator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where ACTIVITY_ID = #{activityId,jdbcType=DECIMAL}
		and CODE = #{code,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey"
		parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update TOM_ACTIVITY_EMPS_RELATION
		set STATUS =
		#{status,jdbcType=VARCHAR},
		APPLY_STATUS =
		#{applyStatus,jdbcType=VARCHAR},
		APPLY_TYPE =
		#{applyType,jdbcType=VARCHAR},
		IS_REQUIRED =
		#{isRequired,jdbcType=VARCHAR},
		CREATOR = #{creator,jdbcType=VARCHAR},
		CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
		OPERATOR =
		#{operator,jdbcType=VARCHAR},
		UPDATE_TIME =
		#{updateTime,jdbcType=TIMESTAMP}
		where ACTIVITY_ID =
		#{activityId,jdbcType=DECIMAL}
		and CODE = #{code,jdbcType=VARCHAR}
	</update>
	
	<select id="selectByActivityId" resultMap="BaseResultMap" parameterType="int">
		select
		<include refid="Base_Column_List" />
		from TOM_ACTIVITY_EMPS_RELATION where ACTIVITY_ID = #{activityId,jdbcType=DECIMAL} and APPLY_TYPE='E'
	</select>
	
	<select id="selectByActivitycode" resultMap="BaseResultMap" parameterType="String">
		select
		<include refid="Base_Column_List" />
		from TOM_ACTIVITY_EMPS_RELATION where CODE = #{code,jdbcType=VARCHAR} and APPLY_STATUS='Y'
	</select>
	 <delete id="deleteByActivityId" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from TOM_ACTIVITY_EMPS_RELATION
    where ACTIVITY_ID = #{activityId,jdbcType=DECIMAL}
  </delete>
  <select id="countByExample" resultType="int" parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		select
		count(*)
		from TOM_ACTIVITY_EMPS_RELATION where  APPLY_TYPE!='P'
		<if test="activityId != null">
				and ACTIVITY_ID = #{activityId,jdbcType=DECIMAL}
			</if>
			<if test="status != null">
				and STATUS = #{status,jdbcType=VARCHAR}
			</if>
			<if test="applyStatus != null">
				and APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
	</select>
	<select id="selectListByExample" resultMap="BaseResultMap" parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		select
		<include refid="Base_Column_List" />
		from TOM_ACTIVITY_EMPS_RELATION where status='Y'
			<if test="activityId != null">
				and ACTIVITY_ID=#{activityId,jdbcType=DECIMAL}
			</if>
			<if test="applyStatus != null">
				and APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
			<if test="operator != null">
				and OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
	</select>
	<select id="selectListExample" resultMap="BaseResultMap" parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		select a.*,b.name
		from TOM_ACTIVITY_EMPS_RELATION a,TOM_EMP b where a.code=b.code and status='Y' and APPLY_TYPE!='P'
			<if test="activityId != null">
				and a.ACTIVITY_ID=#{activityId,jdbcType=DECIMAL}
			</if>
			<if test="applyStatus != null">
				and a.APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and a.APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and a.IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
			<if test="operator != null">
				and a.OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
			 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	
	<select id="selectListApplyExample" resultMap="BaseResultMap" parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		select a.*,b.name,b.deptname,b.jobname,b.secret_email,b.mobile
		from TOM_ACTIVITY_EMPS_RELATION a,TOM_EMP b where a.code=b.code and status='Y' and APPLY_STATUS = 'Y' and APPLY_TYPE!='P'
			<if test="activityId != null">
				and a.ACTIVITY_ID=#{activityId,jdbcType=DECIMAL}
			</if>
			<if test="applyStatus != null">
				and a.APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and a.APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and a.IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
			<if test="operator != null">
				and a.OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
			 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	
	<select id="countByApplyExample" resultType="int" parameterType="com.chinamobo.ue.activity.entity.TomActivityEmpsRelation">
		select
		count(*)
		from TOM_ACTIVITY_EMPS_RELATION where  APPLY_TYPE!='P' and APPLY_STATUS = 'Y'
		<if test="activityId != null">
				and ACTIVITY_ID = #{activityId,jdbcType=DECIMAL}
			</if>
			<if test="status != null">
				and STATUS = #{status,jdbcType=VARCHAR}
			</if>
			<if test="applyStatus != null">
				and APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
	</select>
	
	
	<select id="selectByActivityId2" resultMap="BaseResultMap" parameterType="int">
		select
		<include refid="Base_Column_List" />
		from TOM_ACTIVITY_EMPS_RELATION where ACTIVITY_ID = #{activityId,jdbcType=DECIMAL} and APPLY_STATUS='Y'
	</select>
	
	<select id="selectListEmpExample" resultMap="ResultActivityEmpMap" parameterType="com.chinamobo.ue.activity.dto.TomActivityEmpDto">
	    select a.*,b.name,b.SECRET_EMAIL,b.officephone,b.deptname,b.postname,b.jobname
		from TOM_ACTIVITY_EMPS_RELATION a,TOM_EMP b where a.code=b.code and status='Y' and APPLY_TYPE!='P'
			<if test="activityId != null">
				and a.ACTIVITY_ID=#{activityId,jdbcType=DECIMAL}
			</if>
			<if test="applyStatus != null">
				and a.APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and a.APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and a.IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
			<if test="operator != null">
				and a.OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
			 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	
	</select>
	
	<select id="countByProcessExample" resultType="int" parameterType="com.chinamobo.ue.activity.dto.TomActivityProcessDto">
		select
		count(*)
		from TOM_ACTIVITY_EMPS_RELATION where  APPLY_TYPE!='P'
			<if test="activityId != null">
				and ACTIVITY_ID = #{activityId,jdbcType=DECIMAL}
			</if>
			<if test="status != null">
				and STATUS = #{status,jdbcType=VARCHAR}
			</if>
			<if test="applyStatus != null">
				and APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
	</select>
	<select id="selectProcessListExample" resultMap="ActivityProcessMap" parameterType="com.chinamobo.ue.activity.dto.TomActivityProcessDto">
		select a.*,b.name
		from TOM_ACTIVITY_EMPS_RELATION a,TOM_EMP b where a.code=b.code and status='Y' and APPLY_TYPE!='P'
			<if test="activityId != null">
				and a.ACTIVITY_ID=#{activityId,jdbcType=DECIMAL}
			</if>
			<if test="applyStatus != null">
				and a.APPLY_STATUS = #{applyStatus,jdbcType=VARCHAR}
			</if>
			<if test="applyType != null">
				and a.APPLY_TYPE = #{applyType,jdbcType=VARCHAR}
			</if>
			<if test="isRequired != null">
				and a.IS_REQUIRED = #{isRequired,jdbcType=VARCHAR}
			</if>
			<if test="operator != null">
				and a.OPERATOR = #{operator,jdbcType=VARCHAR}
			</if>
			 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	
	<select id="selectAllListExample" parameterType="map" resultMap="ActivityProcessMap">
		select distinct a.activity_id,r.code ,
		    (select name from tom_emp where code=r.code) NAME,
			(select count(*) from tom_activity_property where activity_id=a.activity_id ) TOTAL_TASK,
			(select count(course_id) from tom_course_learning_record l where r.code = l.code and l.course_id in (select course_id from tom_activity_property where activity_id=a.activity_id and course_id is not null) ) FINISHED_COURSE_TASK,
			(select count(exam_id) from tom_exam_score ts where r.code = ts.code and exam_id in (select exam_id from tom_activity_property where activity_id=a.activity_id) and ts.grade_state='Y') FINISHED_EXAM_TASK
		from tom_activity_property a   
			join tom_activity_emps_relation r on a.activity_id = r.activity_id and a.activity_id=#{activityId,jdbcType=DECIMAL}
		limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="selectActiveListByEmp" resultType="com.chinamobo.ue.activity.dto.TomActivityEmpDto" parameterType="map"> 
		select  e.code,a.activity_id acitvityId,a.Activity_name name,a.need_apply needApply,a.activity_start_time startTime,a.activity_end_time endTime,a.admins from tom_activity_emps_relation e join tom_activity a on e.activity_id = a.activity_id and e.code = #{code,jdbcType=VARCHAR}
		limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="countActiveListByEmp" resultType="int" parameterType="map"> 
		select count(e.code)from tom_activity_emps_relation e join tom_activity a on e.activity_id = a.activity_id and e.code = #{code,jdbcType=VARCHAR}
	</select>
	<select id="selectpingtaibyDate" resultType="com.chinamobo.ue.activity.dto.TomActivityEmpDto" parameterType="map"> 
		select a.* ,(select count(distinct code) from tom_learntime_log  i where a.createDate = DATE(i.CREATE_TIME)) learnCount from(
		select Date(create_date)createDate,count(code) loginCount ,count(distinct code) pelCount from tom_active_user
		
		where 1=1 
		<if test="beginTime != null">
			<![CDATA[	AND	Date(create_date) >= #{beginTime,jdbcType=VARCHAR}]]>
		</if>
		<if test="endTime != null">
			<![CDATA[	AND	Date(create_date) <= #{endTime,jdbcType=VARCHAR}]]>
		</if>
		
		 group by   Date(create_date) order by create_date desc) a
		 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="countpingtaibyDate" resultType="int"  parameterType="map"> 
		select count(distinct Date(create_date)) from tom_active_user
		where 1=1 
		<if test="beginTime != null">
			<![CDATA[	AND	Date(create_date) >= #{beginTime,jdbcType=VARCHAR}]]>
		</if>
		<if test="endTime != null">
			<![CDATA[	AND	Date(create_date) <= #{endTime,jdbcType=VARCHAR}]]>
		</if>
	</select>
	<select id="selectLogintimebyDate" resultType="com.chinamobo.ue.activity.dto.TomActivityEmpDto" parameterType="map"> 
		SELECT  DATE(CREATE_DATE) createDate,
			MIN(CREATE_DATE) mintime,
		TIMESTAMPDIFF(MINUTE,MIN(CREATE_DATE),MAX(CREATE_DATE)) timecount FROM 
		tom_active_user WHERE 1=1 and CODE = #{code,jdbcType=VARCHAR}
		 
		<if test="beginTime != null">
			<![CDATA[	AND	Date(create_date) >= #{beginTime,jdbcType=VARCHAR}]]>
		</if>
		<if test="endTime != null">
			<![CDATA[	AND	Date(create_date) <= #{endTime,jdbcType=VARCHAR}]]>
		</if>
		
		 GROUP BY DATE(CREATE_DATE)  order by DATE(CREATE_DATE) desc
		 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="countLogintimebyDate" resultType="int"  parameterType="map"> 
		SELECT count(distinct DATE(CREATE_DATE))  FROM 
		tom_active_user WHERE 1=1 and CODE = #{code,jdbcType=VARCHAR}
		
		<if test="beginTime != null">
			<![CDATA[	AND	Date(create_date) >= #{beginTime,jdbcType=VARCHAR}]]>
		</if>
		<if test="endTime != null">
			<![CDATA[	AND	Date(create_date) <= #{endTime,jdbcType=VARCHAR}]]>
		</if>
	</select>
	<select id="selectpingtailearn" resultType="com.chinamobo.ue.system.entity.TomEmp" parameterType="map"> 
		SELECT distinct e.code,e.name, e.orgName,e.deptname,e.depttopname  FROM
			tom_emp e,tom_learntime_log sir  where  e.code=sir.code and date(sir.create_time) = #{createDate,jdbcType=VARCHAR}
		 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="countpingtailearn" resultType="int" parameterType="map"> 
		SELECT count(distinct e.code ) FROM
			tom_emp e,tom_learntime_log sir  where  e.code=sir.code and date(sir.create_time) = #{createDate,jdbcType=VARCHAR}
		
	</select>
	<select id="selectpingtaipel" resultType="com.chinamobo.ue.system.entity.TomEmp" parameterType="map"> 
		SELECT distinct e.code,e.name, e.orgName,e.deptname,e.depttopname  FROM
			tom_emp e,tom_active_user au where  e.code=au.code and date(au.create_date) = #{createDate,jdbcType=VARCHAR}
		 limit<![CDATA[#{startNum,jdbcType=DECIMAL},#{endNum,jdbcType=DECIMAL}]]>
	</select>
	<select id="countpingtaipel" resultType="int" parameterType="map"> 
		SELECT count(distinct e.code )  FROM
			tom_emp e,tom_active_user au where  e.code=au.code and date(au.create_date) = #{createDate,jdbcType=VARCHAR}
		 
	</select>
	<!-- 查询时间段内人员的总活动数 -->
	<select id="countEmpAll" resultType="int" parameterType="map">
		SELECT count(*) FROM
		tom_activity_emps_relation a
		LEFT JOIN
		tom_activity b
		on a.activity_id=b.activity_id
		WHERE a.STATUS='Y'
		<if test="code != null">
			and INSTR(a.CODE,#{code,jdbcType=VARCHAR})>0
		</if>
		<if test="beginTimeq != null and '' != beginTimeq">
		  	and #{beginTimeq,jdbcType=TIMESTAMP} <![CDATA[<= b.ACTIVITY_START_TIME]]>
		</if>
	    <if test="endTimeq != null and '' != endTimeq">
	    	and #{endTimeq,jdbcType=TIMESTAMP} <![CDATA[>= b.ACTIVITY_END_TIME]]>
	    </if>
	</select>
	<!-- 查询时间段内人员的活动ID -->
	<select id="selectEmpAll" resultType="com.chinamobo.ue.reportforms.dto.EmpActivityDto"  parameterType="map">
		SELECT a.activity_id as activityId,c.EXAM_ID as examId,c.COURSE_ID as courseId
		FROM
		tom_activity_emps_relation a
		LEFT JOIN
		tom_activity b
		on a.activity_id=b.activity_id
		LEFT JOIN
		tom_activity_property c
		on c.activity_id=b.activity_id
		WHERE 1=1
		<if test="code != null">
			and INSTR(CODE,#{code,jdbcType=VARCHAR})>0
		</if>
		<if test="beginTimeq != null and '' != beginTimeq">
		  	and #{beginTimeq,jdbcType=TIMESTAMP} <![CDATA[<= b.ACTIVITY_START_TIME]]>
		</if>
	    <if test="endTimeq != null and '' != endTimeq">
	    	and #{endTimeq,jdbcType=TIMESTAMP} <![CDATA[>= b.ACTIVITY_END_TIME]]>
	    </if>
	    and a.STATUS='Y'
	</select>
	<select id="selectActEmpById" resultMap="BaseResultMap" parameterType="int">
		select
		*
		from TOM_ACTIVITY_EMPS_RELATION a where ACTIVITY_ID = #{activityId,jdbcType=DECIMAL} and APPLY_TYPE='E'
    	and a.code in (select code from tom_emp where poststat = 'Y')
	</select>
</mapper>